<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <button id="sendButton">Send to HID Device</button>
    <button id="listBt">List</button>
    <div>
        <h5>Device list</h5>
        <div id="dlist">

        </div>
        <input type="color" id="colorPicker" value="#ff0000">
        <div class="color-display" id="colorDisplay"></div>
        <div id="rgbValues"></div>
    </div>
    <script>
        const colorPicker = document.getElementById('colorPicker');
        const colorDisplay = document.getElementById('colorDisplay');
        const rgbValues = document.getElementById('rgbValues');

        var r = 0xFF;
        var g = 0xFF;
        var b = 0xFF;

        function updateColor() {
            // Get selected color in hexadecimal format
            const hex = colorPicker.value;

            // Update color display
            colorDisplay.style.backgroundColor = hex;

            // Convert hex to RGB
            r = parseInt(hex.substring(1, 3), 16);
            g = parseInt(hex.substring(3, 5), 16);
            b = parseInt(hex.substring(5, 7), 16);

            // Display RGB values
            rgbValues.textContent = `RGB: ${r}, ${g}, ${b}`;
        }

        // Initial update
        updateColor();

        // Add event listener for color changes
        colorPicker.addEventListener('input', updateColor);

        var dev = null;

        document.addEventListener('DOMContentLoaded', function(){console.log("loaded")});

        var elist = document.getElementById('dlist');
        document.getElementById("listBt").addEventListener("click", showDeviceList);

        async function showDeviceList() {
            const devices = await navigator.hid.requestDevice({
                filters: [] 
            });

            for (const device of devices) {
                elist.innerHTML += `Device: ${device.productName}\n`;
                elist.innerHTML += `  Vendor ID: 0x${device.vendorId.toString(16)}`;
            }
        }

        async function sendHidPacket() {

            const packet0 = new Uint8Array([0x04, 0x18, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]);
            const packet1 = new Uint8Array([0x04, 0x13, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x01, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]);
            const packet2 = new Uint8Array([0x80, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0f, 0x0, 0x0, 0x0, 0x0, 0xaa, 0x55, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]);
            const packet3 = new Uint8Array([0x04, 0x02,0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]);
            const packet4 = new Uint8Array([0x04, 0xf0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]);
            const packet5 = new Uint8Array([0x04, 0x18, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]);
            const packet6 = new Uint8Array([0x04, 0x23, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x09, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]);

            const packet7 = new Uint8Array([0x0, 0x0, 0x0, 0x0, 0x1, r, g, b, 0x2, r, g, b, 0x3, r, g, b, 0x4, r, g, b, 0x5, r, g, b, 0x6, r, g, b, 0x7, r, g, b, 0x8, r, g, b, 0x9, r, g, b, 0xa, r, g, b, 0xb, r, g, b, 0xc, r, g, b, 0xd, r, g, b, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]);
            const packet8 = new Uint8Array([0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x13, r, g, b, 0x14, r, g, b, 0x15, r, g, b, 0x16, r, g, b, 0x17, r, g, b, 0x18, r, g, b, 0x19, r, g, b, 0x1a, r, g, b, 0x1b, r, g, b, 0x1c, r, g, b, 0x1d, r, g, b, 0x1e, r, g, b, 0x1f, r, g, b]);
            const packet9 = new Uint8Array([0x20, r, g, b, 0x21, r, g, b, 0x22, r, g, b, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x25, r, g, b, 0x26, r, g, b, 0x27, r, g, b, 0x28, r, g, b, 0x29, r, g, b, 0x2a, r, g, b,  0x2b, r, g, b, 0x2c, r, g, b, 0x2d, r, g, b, 0x2e, r, g, b, 0x2f, r, g, b]);
            const packet10 = new Uint8Array([0x30, r, g, b, 0x31, r, g, b, 0x32, r, g, b, 0x33, r, g, b, 0x34, r, g, b, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x37, r, g, b, 0x38, r, g, b, 0x39, r, g, b, 0x3a, r, g, b, 0x3b, r, g, b, 0x3c, r, g, b, 0x3d, r, g, b, 0x3e, r, g, b, 0x3f, r, g, b]);
            const packet11 = new Uint8Array([0x40, r, g, b, 0x41, r, g, b, 0x42, r, g, b, 0x43, r, g, b, 0x44, r, g, b, 0x45, r, g, b, 0x46, r, g, b, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x49, r, g, b, 0x4a, r, g, b, 0x4b, r, g, b, 0x4c, r, g, b, 0x4d, r, g, b, 0x4e, r, g, b, 0x4f, r, g, b]);
            const packet12 = new Uint8Array([0x50, r, g, b, 0x51, r, g, b, 0x52, r, g, b, 0x53, r, g, b, 0x54, r, g, b, 0x55, r, g, b, 0x56, r, g, b, 0x57, r, g, b, 0x58, r, g, b, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x5b, r, g, b, 0x5c, r, g, b, 0x5d, r, g, b, 0x5e, r, g, b, 0x5f, r, g, b]);
            const packet13 = new Uint8Array([0x60, r, g, b, 0x0, 0x0, 0x0, 0x0, 0x62, r, g, b, 0x63, r, g, b, 0x64, r, g, b, 0x65, r, g, b, 0x66, r, g, b, 0x67, r, g, b, 0x68, 0x0, 0x0, 0x0, 0x69, r, g, b, 0x6a, r, g, b, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]);
            const packet14 = new Uint8Array([0x70, r, g, b, 0x71, r, g, b, 0x0, 0x0, 0x0, 0x0, 0x73, r, g, b, 0x74, r, g, b, 0x75, r, g, b, 0x76, r, g, b, 0x77, r, g, b, 0x78, r, g, b, 0x79, r, g, b, 0x7a, r, g, b, 0x7b, r, g, b, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]);

            const packet15 = new Uint8Array([0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xaa, 0x55]);
            const packet16 = new Uint8Array([0x04, 0x02, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]);
            const packet17 = new Uint8Array([0x04, 0xf0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]);


            try {
                
                const [device] = await navigator.hid.requestDevice({
                    filters: [
                        { vendorId: 0xc45, productId: 0x8006 },
                        //                 { usagePage: 0xFF60, usage: 0x61 }
                    ]
                });

                if (!device) {
                    console.log('No device selected');
                    return;
                }

                dev = device;

                await device.open();

                console.log('Device opened:', device.productName);

                async function sleep(msec) {
                    return new Promise(resolve => setTimeout(resolve, msec));
                }

                // TODO Добавить прерывания
                device.sendFeatureReport(0, packet0);await sleep(100);
                device.receiveFeatureReport(0);await sleep(100);
                device.sendFeatureReport(0, packet1);await sleep(100);
                device.receiveFeatureReport(0);await sleep(100);
                device.sendFeatureReport(0, packet2);await sleep(100);
                device.sendFeatureReport(0, packet3);await sleep(100);
                device.receiveFeatureReport(0);await sleep(100);
                device.sendFeatureReport(0, packet4);await sleep(100);
                device.sendFeatureReport(0, packet5);await sleep(100);
                device.receiveFeatureReport(0);await sleep(100);
                device.sendFeatureReport(0, packet6);await sleep(100);
                device.receiveFeatureReport(0);await sleep(100);
                device.sendFeatureReport(0, packet7);await sleep(100);
                device.sendFeatureReport(0, packet8);await sleep(100);
                device.sendFeatureReport(0, packet9);await sleep(100);
                device.sendFeatureReport(0, packet10);await sleep(100);
                device.sendFeatureReport(0, packet11);await sleep(100);
                device.sendFeatureReport(0, packet12);await sleep(100);
                device.sendFeatureReport(0, packet13);await sleep(100);
                device.sendFeatureReport(0, packet14);await sleep(100);
                device.sendFeatureReport(0, packet15);await sleep(100);
                device.sendFeatureReport(0, packet16);await sleep(100);
                device.receiveFeatureReport(0);await sleep(100);
                device.sendFeatureReport(0, packet17);await sleep(100);
                device.receiveFeatureReport(0);await sleep(100);

                console.log('Packet sent successfully');

                device.close();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        document.getElementById('sendButton').addEventListener('click', sendHidPacket);
    </script>
</body>
</html>
